---
source: https://alexandra-zaharia.github.io/posts/custom-logger-in-python-for-stdout-and-or-file-log/ \
created: 2022-12-26T22:17:18 (UTC +01:00) \
tags: [] \
author: Alexandra Zaharia
---
# Custom logger in Python for stdout and/or file log | Alexandra Zaharia
---
The Python [`logging`](https://docs.python.org/3/library/logging.html) module may be used to build your own custom logger featuring special functionality according to your use case, such as:

-   Adding both console and file handlers (i.e. logging to both stdout and to a file)
-   Temporarily disabling console logging (e.g. if a global verbose flag is `False`)
-   Temporarily disabling file logging (e.g. if we want to print with color to stdout using ANSI codes, but without color to the log file)
-   Adding an extra logging level that logs to both console and log file (e.g. even if a global verbose flag is `False`)

This post will show how to build such a custom logger for the above use cases, that we will be going through incrementally. The full code is available on [GitHub](https://github.com/alexandra-zaharia/python-playground/tree/main/custom_logger_console_and_or_file).

## Custom logger with stdout and file handlers

We will be creating a `CustomLogger` class based on `logging.getLoggerClass()` (the logger used in Python’s `logging` module) with a default stdout handler. If the user of the class specifies a log directory, then a file handler will also be added. The format of the logs is also different:

-   we use the bare message to log for the stdout handler
-   we show the date, time, logging level, file and line number for the file handler

``<table><tbody><tr><td><pre>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 </pre></td><td><pre><span>class</span> <span>CustomLogger</span><span>(</span><span>logging</span><span>.</span><span>getLoggerClass</span><span>()):</span>     <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>name</span><span>,</span> <span>log_dir</span><span>=</span><span>None</span><span>):</span>         <span># Create custom logger logging all five levels </span>        <span>super</span><span>().</span><span>__init__</span><span>(</span><span>name</span><span>)</span>         <span>self</span><span>.</span><span>setLevel</span><span>(</span><span>logging</span><span>.</span><span>DEBUG</span><span>)</span>          <span># Create stream handler for logging to stdout (log all five levels) </span>        <span>self</span><span>.</span><span>stdout_handler</span> <span>=</span> <span>logging</span><span>.</span><span>StreamHandler</span><span>(</span><span>sys</span><span>.</span><span>stdout</span><span>)</span>         <span>self</span><span>.</span><span>stdout_handler</span><span>.</span><span>setLevel</span><span>(</span><span>logging</span><span>.</span><span>DEBUG</span><span>)</span>         <span>self</span><span>.</span><span>stdout_handler</span><span>.</span><span>setFormatter</span><span>(</span><span>logging</span><span>.</span><span>Formatter</span><span>(</span><span>'%(message)s'</span><span>))</span>         <span>self</span><span>.</span><span>enable_console_output</span><span>()</span>          <span># Add file handler only if the log directory was specified </span>        <span>self</span><span>.</span><span>file_handler</span> <span>=</span> <span>None</span>         <span>if</span> <span>log_dir</span><span>:</span>             <span>self</span><span>.</span><span>add_file_handler</span><span>(</span><span>name</span><span>,</span> <span>log_dir</span><span>)</span>      <span>def</span> <span>add_file_handler</span><span>(</span><span>self</span><span>,</span> <span>name</span><span>,</span> <span>log_dir</span><span>):</span>         <span>"""Add a file handler for this logger with the specified `name` (and         store the log file under `log_dir`)."""</span>         <span># Format for file log </span>        <span>fmt</span> <span>=</span> <span>'%(asctime)s | %(levelname)8s | %(filename)s:%(lineno)d | %(message)s'</span>         <span>formatter</span> <span>=</span> <span>logging</span><span>.</span><span>Formatter</span><span>(</span><span>fmt</span><span>)</span>          <span># Determine log path/file name; create log_dir if necessary </span>        <span>now</span> <span>=</span> <span>datetime</span><span>.</span><span>datetime</span><span>.</span><span>now</span><span>().</span><span>strftime</span><span>(</span><span>'%Y%m%d_%H%M%S'</span><span>)</span>         <span>log_name</span> <span>=</span> <span>f</span><span>'</span><span>{</span><span>str</span><span>(</span><span>name</span><span>).</span><span>replace</span><span>(</span><span>" "</span><span>,</span> <span>"_"</span><span>)</span><span>}</span><span>_</span><span>{</span><span>now</span><span>}</span><span>'</span>         <span>if</span> <span>not</span> <span>os</span><span>.</span><span>path</span><span>.</span><span>exists</span><span>(</span><span>log_dir</span><span>):</span>             <span>try</span><span>:</span>                 <span>os</span><span>.</span><span>makedirs</span><span>(</span><span>log_dir</span><span>)</span>             <span>except</span><span>:</span>                 <span>print</span><span>(</span><span>'{}: Cannot create directory {}. '</span><span>.</span><span>format</span><span>(</span>                     <span>self</span><span>.</span><span>__class__</span><span>.</span><span>__name__</span><span>,</span> <span>log_dir</span><span>),</span>                     <span>end</span><span>=</span><span>''</span><span>,</span> <span>file</span><span>=</span><span>sys</span><span>.</span><span>stderr</span><span>)</span>                 <span>log_dir</span> <span>=</span> <span>'/tmp'</span> <span>if</span> <span>sys</span><span>.</span><span>platform</span><span>.</span><span>startswith</span><span>(</span><span>'linux'</span><span>)</span> <span>else</span> <span>'.'</span>                 <span>print</span><span>(</span><span>f</span><span>'Defaulting to </span><span>{</span><span>log_dir</span><span>}</span><span>.'</span><span>,</span> <span>file</span><span>=</span><span>sys</span><span>.</span><span>stderr</span><span>)</span>          <span>log_file</span> <span>=</span> <span>os</span><span>.</span><span>path</span><span>.</span><span>join</span><span>(</span><span>log_dir</span><span>,</span> <span>log_name</span><span>)</span> <span>+</span> <span>'.log'</span>          <span># Create file handler for logging to a file (log all five levels) </span>        <span>self</span><span>.</span><span>file_handler</span> <span>=</span> <span>logging</span><span>.</span><span>FileHandler</span><span>(</span><span>log_file</span><span>)</span>         <span>self</span><span>.</span><span>file_handler</span><span>.</span><span>setLevel</span><span>(</span><span>logging</span><span>.</span><span>DEBUG</span><span>)</span>         <span>self</span><span>.</span><span>file_handler</span><span>.</span><span>setFormatter</span><span>(</span><span>formatter</span><span>)</span>         <span>self</span><span>.</span><span>addHandler</span><span>(</span><span>self</span><span>.</span><span>file_handler</span><span>)</span> </pre></td></tr></tbody></table>``

Notice that we store both the stdout handler and the file handler as members of the `CustomLogger`, through the instance variables `self.stdout_handler` and `self.file_handler`. This is to facilitate the forthcoming tasks, namely to check whether the logger has such handlers and to be able to enable and disable them individually.

At lines 28-36, when adding a file handler, we try to create the log directory if it does not exist. If this fails due to a missing permissions issue, we default to writing log files to `/tmp` on Linux or to the current directory for other operating systems.

## Check whether the logger has a stream handler and/or a file handler

The Python `logging` documentation explains that [`logging.StreamHandler`](https://docs.python.org/3/library/logging.handlers.html#logging.StreamHandler) is the base class for `logging.FileHandler`. We therefore need to take special care when checking whether the logger has a file handler, since the `isinstance` check will not be enough:

`<table><tbody><tr><td><pre>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 </pre></td><td><pre><span>In</span> <span>[</span><span>159</span><span>]:</span> <span>sh</span> <span>=</span> <span>logging</span><span>.</span><span>StreamHandler</span><span>()</span>  <span>In</span> <span>[</span><span>160</span><span>]:</span> <span>fh</span> <span>=</span> <span>logging</span><span>.</span><span>FileHandler</span><span>(</span><span>'x'</span><span>)</span>  <span>In</span> <span>[</span><span>161</span><span>]:</span> <span>isinstance</span><span>(</span><span>sh</span><span>,</span> <span>logging</span><span>.</span><span>StreamHandler</span><span>)</span> <span>Out</span><span>[</span><span>161</span><span>]:</span> <span>True</span>  <span>In</span> <span>[</span><span>162</span><span>]:</span> <span>isinstance</span><span>(</span><span>fh</span><span>,</span> <span>logging</span><span>.</span><span>StreamHandler</span><span>)</span> <span>Out</span><span>[</span><span>162</span><span>]:</span> <span>True</span>  <span>In</span> <span>[</span><span>163</span><span>]:</span> <span>type</span><span>(</span><span>sh</span><span>)</span> <span>==</span> <span>logging</span><span>.</span><span>StreamHandler</span> <span>Out</span><span>[</span><span>163</span><span>]:</span> <span>True</span>  <span>In</span> <span>[</span><span>164</span><span>]:</span> <span>type</span><span>(</span><span>fh</span><span>)</span> <span>==</span> <span>logging</span><span>.</span><span>StreamHandler</span> <span>Out</span><span>[</span><span>164</span><span>]:</span> <span>False</span>  <span>In</span> <span>[</span><span>165</span><span>]:</span> <span>type</span><span>(</span><span>fh</span><span>)</span> <span>==</span> <span>logging</span><span>.</span><span>FileHandler</span> <span>Out</span><span>[</span><span>165</span><span>]:</span> <span>True</span> </pre></td></tr></tbody></table>`

Armed with this knowledge, we can now add methods to our `CustomLogger` class to find out whether the logger instance has a console logger and/or a file logger:

`<table><tbody><tr><td><pre>1 2 3 4 5 </pre></td><td><pre><span>def</span> <span>has_console_handler</span><span>(</span><span>self</span><span>):</span>     <span>return</span> <span>len</span><span>([</span><span>h</span> <span>for</span> <span>h</span> <span>in</span> <span>self</span><span>.</span><span>handlers</span> <span>if</span> <span>type</span><span>(</span><span>h</span><span>)</span> <span>==</span> <span>logging</span><span>.</span><span>StreamHandler</span><span>])</span> <span>&gt;</span> <span>0</span>  <span>def</span> <span>has_file_handler</span><span>(</span><span>self</span><span>):</span>     <span>return</span> <span>len</span><span>([</span><span>h</span> <span>for</span> <span>h</span> <span>in</span> <span>self</span><span>.</span><span>handlers</span> <span>if</span> <span>isinstance</span><span>(</span><span>h</span><span>,</span> <span>logging</span><span>.</span><span>FileHandler</span><span>)])</span> <span>&gt;</span> <span>0</span> </pre></td></tr></tbody></table>`

## Disable logger console output

Using the `has_console_handler()` check to ensure internal API consistency, we can now write methods for our `CustomLogger` class to temporarily enable/disable console output. Since the logger retains the instance variable `self.stdout_handler`, we can add it and remove it as we please:

`<table><tbody><tr><td><pre>1 2 3 4 5 6 7 8 9 </pre></td><td><pre><span>def</span> <span>disable_console_output</span><span>(</span><span>self</span><span>):</span>     <span>if</span> <span>not</span> <span>self</span><span>.</span><span>has_console_handler</span><span>():</span>         <span>return</span>     <span>self</span><span>.</span><span>removeHandler</span><span>(</span><span>self</span><span>.</span><span>stdout_handler</span><span>)</span>  <span>def</span> <span>enable_console_output</span><span>(</span><span>self</span><span>):</span>     <span>if</span> <span>self</span><span>.</span><span>has_console_handler</span><span>():</span>         <span>return</span>     <span>self</span><span>.</span><span>addHandler</span><span>(</span><span>self</span><span>.</span><span>stdout_handler</span><span>)</span> </pre></td></tr></tbody></table>`

## Disable logger file output

Similarly to what we’ve seen above, via the `has_file_handler()` check in order to ensure internal API consistency, we can now write methods for our `CustomLogger` class to temporarily enable/disable file output. Since the logger retains the instance variable `self.file_handler`, we can add it and remove it as we please:

`<table><tbody><tr><td><pre>1 2 3 4 5 6 7 8 9 </pre></td><td><pre><span>def</span> <span>disable_file_output</span><span>(</span><span>self</span><span>):</span>     <span>if</span> <span>not</span> <span>self</span><span>.</span><span>has_file_handler</span><span>():</span>         <span>return</span>     <span>self</span><span>.</span><span>removeHandler</span><span>(</span><span>self</span><span>.</span><span>file_handler</span><span>)</span>  <span>def</span> <span>enable_file_output</span><span>(</span><span>self</span><span>):</span>     <span>if</span> <span>self</span><span>.</span><span>has_file_handler</span><span>():</span>         <span>return</span>     <span>self</span><span>.</span><span>addHandler</span><span>(</span><span>self</span><span>.</span><span>file_handler</span><span>)</span> </pre></td></tr></tbody></table>`

## Verbosity setting for the custom logger

In certain situations, you way need to create a more quiet or a more verbose logger. If the logger needs to be quiet, you may want to skip logging altogether. This means we need to override the `info()`, `debug()`, `warning()`, `error()` and `critical()` methods of the base class and make them behave differently according to the verbosity setting. (Your use case might be different and you may want to keep logging enabled for `ERROR` and `CRITICAL` levels for example.)

First, we introduce a `verbose` boolean flag to the `__init__()` method of our `CustomLogger` class and store its value in the logger instance. Then, we override the logging methods:

``<table><tbody><tr><td><pre>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 </pre></td><td><pre><span>class</span> <span>CustomLogger</span><span>(</span><span>logging</span><span>.</span><span>getLoggerClass</span><span>()):</span>     <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>name</span><span>,</span> <span>verbose</span><span>,</span> <span>log_dir</span><span>=</span><span>None</span><span>):</span>         <span>...</span>         <span>self</span><span>.</span><span>verbose</span> <span>=</span> <span>verbose</span>      <span>def</span> <span>debug</span><span>(</span><span>self</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>):</span>         <span>self</span><span>.</span><span>_custom_log</span><span>(</span><span>super</span><span>().</span><span>debug</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>)</span>      <span>def</span> <span>info</span><span>(</span><span>self</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>):</span>         <span>self</span><span>.</span><span>_custom_log</span><span>(</span><span>super</span><span>().</span><span>info</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>)</span>      <span>def</span> <span>warning</span><span>(</span><span>self</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>):</span>         <span>self</span><span>.</span><span>_custom_log</span><span>(</span><span>super</span><span>().</span><span>warning</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>)</span>      <span>def</span> <span>error</span><span>(</span><span>self</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>):</span>         <span>self</span><span>.</span><span>_custom_log</span><span>(</span><span>super</span><span>().</span><span>error</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>)</span>      <span>def</span> <span>critical</span><span>(</span><span>self</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>):</span>         <span>self</span><span>.</span><span>_custom_log</span><span>(</span><span>super</span><span>().</span><span>critical</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>)</span>      <span>def</span> <span>_custom_log</span><span>(</span><span>self</span><span>,</span> <span>func</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>):</span>         <span>"""Helper method for logging DEBUG through CRITICAL messages by         calling the appropriate `func()` from the base class."""</span>         <span># Log normally if verbosity is on </span>        <span>if</span> <span>self</span><span>.</span><span>verbose</span><span>:</span>             <span>return</span> <span>func</span><span>(</span><span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>)</span>          <span># If verbosity is off and there is no file handler, there is </span>        <span># nothing left to do </span>        <span>if</span> <span>not</span> <span>self</span><span>.</span><span>has_file_handler</span><span>():</span>             <span>return</span>          <span># If verbosity is off and a file handler is present, then disable </span>        <span># stdout logging, log, and finally reenable stdout logging </span>        <span>self</span><span>.</span><span>disable_console_output</span><span>()</span>         <span>func</span><span>(</span><span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>)</span>         <span>self</span><span>.</span><span>enable_console_output</span><span>()</span> </pre></td></tr></tbody></table>``

## Custom logging level that overrides the verbosity setting

Well all this is fine, but what if you _do_ want to display certain messages after all, even if verbosity is off? Think of them as “system” or “framework” messages that should not be silenced.

The solution to this is to add a new logging level to the `CustomLogger` class. Let’s call it `FRAMEWORK` and have it log at `INFO` priority (for the purpose of illustration). We just need to add the level and to write the corresponding `framework()` method:

``<table><tbody><tr><td><pre>1 2 3 4 5 6 7 8 9 10 </pre></td><td><pre><span>class</span> <span>CustomLogger</span><span>(</span><span>logging</span><span>.</span><span>getLoggerClass</span><span>()):</span>     <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>,</span> <span>name</span><span>,</span> <span>verbose</span><span>,</span> <span>log_dir</span><span>=</span><span>None</span><span>):</span>         <span>...</span>         <span>logging</span><span>.</span><span>addLevelName</span><span>(</span><span>logging</span><span>.</span><span>INFO</span><span>,</span> <span>'FRAMEWORK'</span><span>)</span>      <span>def</span> <span>framework</span><span>(</span><span>self</span><span>,</span> <span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>):</span>         <span>"""Logging method for the FRAMEWORK level. The `msg` gets         logged both to stdout and to file (if a file handler is         present), irrespective of verbosity settings."""</span>         <span>return</span> <span>super</span><span>().</span><span>info</span><span>(</span><span>msg</span><span>,</span> <span>*</span><span>args</span><span>,</span> <span>**</span><span>kwargs</span><span>)</span> </pre></td></tr></tbody></table>``

For neat display in the file logs, we should also think of changing the formatter to accommodate 9 characters instead of 8:

`<table><tbody><tr><td><pre>1 </pre></td><td><pre><span>fmt</span> <span>=</span> <span>'%(asctime)s | %(levelname)9s | %(filename)s:%(lineno)d | %(message)s'</span> </pre></td></tr></tbody></table>`

## Putting the custom logger to use

We can now test the logger in both quiet and verbose mode.

### Quiet mode

In quiet mode this is really straightforward:

`<table><tbody><tr><td><pre>1 2 3 4 </pre></td><td><pre><span>def</span> <span>test_quiet</span><span>():</span>     <span>quiet_log</span> <span>=</span> <span>CustomLogger</span><span>(</span><span>'quiet'</span><span>,</span> <span>verbose</span><span>=</span><span>False</span><span>,</span> <span>log_dir</span><span>=</span><span>'logs'</span><span>)</span>     <span>quiet_log</span><span>.</span><span>warning</span><span>(</span><span>'We now log only to a file log'</span><span>)</span>     <span>quiet_log</span><span>.</span><span>framework</span><span>(</span><span>'We now log everywhere irrespective of verbosity'</span><span>)</span> </pre></td></tr></tbody></table>`

On stdout we get:

`<table><tbody><tr><td><pre>1 </pre></td><td><pre>We now log everywhere irrespective of verbosity </pre></td></tr></tbody></table>`

In the file log we get:

`<table><tbody><tr><td><pre>1 2 3 </pre></td><td><pre>cat logs/quiet_20211107_131512.log 2021-11-07 13:15:12,540 |   WARNING | custom_logger.py:124 | We now log only to a file log 2021-11-07 13:15:12,540 | FRAMEWORK | custom_logger.py:108 | We now log everywhere irrespective of verbosity </pre></td></tr></tbody></table>`

### Verbose mode

In verbose mode we can try to spice things up a little bit: we disable file output and we log a colored message to stdout, _only if_ stdout is a true TTY (e.g. if the output is _not_ redirected to a file using `>` or `>>` in Linux). Note that in this example I’m using my custom `Color` enum class, available in the [GitHub](https://github.com/alexandra-zaharia/python-playground/tree/main/custom_logger_console_and_or_file) repo through `color.py`.

`<table><tbody><tr><td><pre>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 </pre></td><td><pre><span>from</span> <span>color</span> <span>import</span> <span>Color</span>  <span># see accompanying file color.py </span>  <span>def</span> <span>test_verbose</span><span>():</span>     <span>verbose_log</span> <span>=</span> <span>CustomLogger</span><span>(</span><span>'verbose'</span><span>,</span> <span>verbose</span><span>=</span><span>True</span><span>,</span> <span>log_dir</span><span>=</span><span>'logs'</span><span>)</span>      <span>verbose_log</span><span>.</span><span>warning</span><span>(</span><span>'We now log to both stdout and a file log'</span><span>)</span>      <span>verbose_log</span><span>.</span><span>disable_file_output</span><span>()</span>     <span>msg</span> <span>=</span> <span>'Use color in a true TTY'</span>     <span>if</span> <span>sys</span><span>.</span><span>stdout</span><span>.</span><span>isatty</span><span>():</span>         <span>verbose_log</span><span>.</span><span>info</span><span>(</span><span>Color</span><span>.</span><span>colored</span><span>(</span><span>Color</span><span>.</span><span>LIGHTYELLOW</span><span>,</span> <span>msg</span><span>))</span>     <span>else</span><span>:</span>         <span>verbose_log</span><span>.</span><span>info</span><span>(</span><span>msg</span> <span>+</span> <span>', but not here'</span><span>)</span>     <span>verbose_log</span><span>.</span><span>enable_file_output</span><span>()</span>      <span>verbose_log</span><span>.</span><span>framework</span><span>(</span><span>'We now log everywhere irrespective of verbosity'</span><span>)</span> </pre></td></tr></tbody></table>`

On stdout we get:

[![Custom logging with color output](https://alexandra-zaharia.github.io/assets/img/posts/custom_logger_color.png)](https://alexandra-zaharia.github.io/assets/img/posts/custom_logger_color.png)

In the file log we get:

`<table><tbody><tr><td><pre>1 2 3 </pre></td><td><pre>cat logs/verbose_20211107_131512.log 2021-11-07 13:15:12,539 |   WARNING | custom_logger.py:115 | We now log to both stdout and a file log 2021-11-07 13:15:12,540 | FRAMEWORK | custom_logger.py:108 | We now log everywhere irrespective of verbosity </pre></td></tr></tbody></table>`

## Accompanying code

The full code accompanying this post can be found on my [GitHub](https://github.com/alexandra-zaharia/python-playground/tree/main/custom_logger_console_and_or_file) repository.
